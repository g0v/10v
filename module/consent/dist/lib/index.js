// Generated by LiveScript 1.6.0
(function(){
  var request, lderror, aux, kit;
  request = require('request');
  lderror = require('lderror');
  aux = require('backend/aux');
  kit = require('backend/throttle/kit');
  (function(it){
    return module.exports = it;
  })(function(backend){
    var db;
    db = backend.db;
    return backend.route.api.post('/consent/', kit.generic, function(req, res, next){
      var ref$, consent_id, check, user;
      ref$ = req.body || {}, consent_id = ref$.consent_id, check = ref$.check;
      user = (req.user || {}).key;
      if (!(user && consent_id)) {
        return res.send(false);
      }
      if (check) {
        return db.query("select * from consent where consent_id = $1 and owner = $2", [consent_id, user]).then(function(r){
          r == null && (r = {});
          return res.send((r.rows || (r.rows = [])).length ? true : false);
        });
      } else {
        return db.query("insert into consent (consent_id, owner, ip, time) values ($1, $2, $3, now())", [consent_id, user, aux.ip(req)]).then(function(){
          return res.send();
        });
      }
    });
  });
}).call(this);
